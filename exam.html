<!DOCTYPE html>
<html style="overflow-x:auto;overflow-y:auto;">
<head>
	<title>试题管理</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="author" content="http://www.jeeplus.org/"/>
<meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=9,IE=10" />
<meta http-equiv="Expires" content="0"><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Cache-Control" content="no-store">
<!-- 引入jquery插件 -->
<script src="http://www.jiudingdalv.com/exam/static/jquery/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="http://www.jiudingdalv.com/exam/static/jquery/jquery-migrate-1.1.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://www.jiudingdalv.com/exam/static/TableDnD/jquery.tablednd.js"></script>
<!-- 引入依赖的第三方插件 -->
<script src="http://www.jiudingdalv.com/exam/static/slimscroll/jquery.slimscroll.min.js"></script>
<script src="http://www.jiudingdalv.com/exam/static/jquery-validation/1.14.0/jquery.validate.min.js" type="text/javascript"></script>
<script src="http://www.jiudingdalv.com/exam/static/jquery-validation/1.14.0/localization/messages_zh.min.js" type="text/javascript"></script>
<link href="http://www.jiudingdalv.com/exam/static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet" />
<script src="http://www.jiudingdalv.com/exam/static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"></script>
<script src="http://www.jiudingdalv.com/exam/static/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
<script src="http://www.jiudingdalv.com/exam/static/pace/pace.min.js"></script>
<script src="http://www.jiudingdalv.com/exam/static/metisMenu/jquery.metisMenu.js"></script>
<link href="http://www.jiudingdalv.com/exam/static/iCheck/custom.css" rel="stylesheet" />
<script src="http://www.jiudingdalv.com/exam/static/iCheck/icheck.min.js"></script>
<script src="http://www.jiudingdalv.com/exam/static/iCheck/icheck-init.js"></script>
<link href="http://www.jiudingdalv.com/exam/static/dataTables/dataTables.bootstrap.css" rel="stylesheet" />
<script src="http://www.jiudingdalv.com/exam/static/dataTables/jquery.dataTables.js"></script>
<script src="http://www.jiudingdalv.com/exam/static/dataTables/dataTables.bootstrap.js"></script>

<!-- jeeplus -->
<link href="http://www.jiudingdalv.com/exam/static/common/jeeplus.css" type="text/css" rel="stylesheet" />
<script src="http://www.jiudingdalv.com/exam/static/common/jeeplus.js" type="text/javascript"></script>

<!-- jquery ui -->
<script src="http://www.jiudingdalv.com/exam/static/jquery-ui/jquery-ui.min.js"></script>

<!-- 引入bootstrap插件 -->
<!-- bootswatch主题效果不怎么好，停止切换，使用官网的默认版本，如果你想切换主题请访问http://bootswatch.com/下载最新版版主题，by刘高峰 -->
<!--  <link href="http://www.jiudingdalv.com/exam/static/bootstrap/3.3.4/css_default/bootstrap.min.css" type="text/css" rel="stylesheet" />-->
<link href="http://www.jiudingdalv.com/exam/static/bootstrap/3.3.4/css_default/bootstrap.min.css" type="text/css" rel="stylesheet" />
<script src="http://www.jiudingdalv.com/exam/static/bootstrap/3.3.4/js/bootstrap.min.js"  type="text/javascript"></script>
<link href="http://www.jiudingdalv.com/exam/static/awesome/4.4/css/font-awesome.min.css" rel="stylesheet" />
<link href="http://www.jiudingdalv.com/exam/static/common/css/style.css?v=3.2.0" type="text/css" rel="stylesheet" />

<!-- 引入layer插件 -->
<script src="http://www.jiudingdalv.com/exam/static/layer-v2.3/layer/layer.js"></script>
<script src="http://www.jiudingdalv.com/exam/static/layer-v2.3/layer/laydate/laydate.js"></script>

<!--引入webuploader-->
<link rel="stylesheet" type="text/css" href="http://www.jiudingdalv.com/exam/static/webuploader-0.1.5/webuploader.css">
<script type="text/javascript" src="http://www.jiudingdalv.com/exam/static/webuploader-0.1.5/webuploader.js"></script>


<!-- 引入自定义文件 -->
<script src="http://www.jiudingdalv.com/exam/static/common/mustache.min.js" type="text/javascript"></script>
<script src="http://www.jiudingdalv.com/exam/static/common/content.js" type="text/javascript"></script>
<link href="http://www.jiudingdalv.com/exam/static/common/css/login.css" type="text/css" rel="stylesheet" />
<script type="text/javascript">var ctx = 'http://www.jiudingdalv.com/exam/a', ctxStatic='http://www.jiudingdalv.com/exam/static';</script>

    <meta name="decorator" content="default"/>
    <script type="text/javascript">
        var validateForm;

        function doSubmit() {//回调函数，在编辑和保存动作时，供openDialog调用提交表单。
            if (validateForm.form()) {
                $("#inputForm").submit();
                return true;
            }

            return false;
        }

        function addRow(list, idx, tpl, row) {
            if ($("#quesType").val() != "type_panduan" && $("#optionList tr").length + 1 > 4) {
                alert("选择题最多只能有4个选项");
                return;
            } else if($("#quesType").val() == "type_panduan" && $("#optionList tr").length + 1 > 2) {
                alert("判断题最多只能有2个选项");
                return;
            }

            $(list).append(Mustache.render(tpl, {
                idx: idx, idx_: idx + 1, delBtn: true, row: row
            }));
            $(list + idx).find("select").each(function () {
                $(this).val($(this).attr("data-value"));
            });
            $(list + idx).find("input[type='checkbox'], input[type='radio']").each(function () {
                var ss = $(this).attr("data-value").split(',');
                for (var i = 0; i < ss.length; i++) {
                    if ($(this).val() == ss[i]) {
                        $(this).attr("checked", "checked");
                    }
                }
            });
            $(list + idx).find(".form_datetime").each(function () {
                $(this).datetimepicker({
                    format: "YYYY-MM-DD"
                });
            });
        }

        function delRow(obj, prefix) {//如果删除的是默认，需要取消第一个记录的默认按钮
            var id = $(prefix + "_id");
            var delFlag = $(prefix + "_delFlag");
            if (id.val() == "") {
                $(obj).parent().parent().remove();
            } else if (delFlag.val() == "0") {
                delFlag.val("1");
                $(obj).html("&divide;").attr("title", "撤销删除");
                $(obj).parent().parent().addClass("error");
            } else if (delFlag.val() == "1") {
                delFlag.val("0");
                $(obj).html("&times;").attr("title", "删除");
                $(obj).parent().parent().removeClass("error");
            }
            rebuildAccountIndex();
            rowIdx = $('.close').length;
        }

        /* 重置序号 */
        function rebuildAccountIndex() {
            $(".option_index").each(function (index) {
                $(this).text(index + 1);
            });
        }

        $(document).ready(function () {
            validateForm = $("#inputForm").validate({
                submitHandler: function (form) {
                    loading('正在提交，请稍等...');
                    form.submit();
                },
                errorContainer: "#messageBox",
                errorPlacement: function (error, element) {
                    $("#messageBox").text("输入有误，请先更正。");
                    if (element.is(":checkbox") || element.is(":radio") || element.parent().is(".input-append")) {
                        error.appendTo(element.parent().parent());
                    } else {
                        error.insertAfter(element);
                    }
                }
            });
            $(".quesOptionList").removeClass("hide");
            /*if ($("#quesType").val() == "type_duoxuan") {
                $('#ifAnswer').addClass("hidden");
                $('.isAnswerHidden').addClass("hidden");
            }*/

            /* 试题类型 */
            $("#quesType").change(function () {
                var quesType = $(this).val();
                if (quesType == "") {
                    $(".answer_select").removeClass("hide");
                    $(".answer_judgment").addClass("hide");
                }
                if (quesType == 'type_danxuan') {
                    $(".answer_select").removeClass("hide");
                    $(".answer_judgment").addClass("hide");
                } else if (quesType == 'type_duoxuan') {
                    $(".answer_select").removeClass("hide");
                    $(".answer_judgment").addClass("hide");
                } else if (quesType == 'type_panduan') {
                    // 隐藏选择题的选择列表，并将答案换成下拉框
                    $(".answer_select").addClass("hide");
                    $(".answer_select").find("input").removeClass("required");

                    $(".answer_judgment").removeClass("hide");
                    $(".answer_judgment").find("input").addClass("required");

                }
            });

            /* 专业 > 学科 > 章节 */
            $("#proId").change(function () {
                var profession = $(this).val();
                getSubjectList(profession);
            });
            getSubjectList($("#proId").val(), 'b74e282250f942da864ef02ae0cac37c');

            /* 学科 > 章节 */
            $("#subId").change(function () {
                var subject = $(this).val();
                getChapterList(subject);
            });
        });

        function getSubjectList(profession, defVal) {   // 测试数据：3675c10258914ee89079ab9459a2dfae
            $.post("http://www.jiudingdalv.com/exam/categoryApi/getChildCategory", {parentId: profession}, function (response) {
                $("#subId").empty();
                var defaultItem = $('<option value="">请选择学科</option>');
                defaultItem.appendTo("#subId");
                $.each(response.data, function (index, item) {
                    var opt = $('<option value="' + item.id + '">' + item.name + '</option>');
                    opt.appendTo("#subId");
                });
                if (defVal != null && defVal != '') {
                    $("#subId").val(defVal);
                    getChapterList($("#subId").val(), '');
                }
            });
        }

        function getChapterList(subject, defVal) {
            $.post("http://www.jiudingdalv.com/exam/categoryApi/getChildCategory", {parentId: subject, type: '3'}, function (response) {
                $("#chapterId").empty();
                var defaultItem = $('<option value="">请选择章节</option>');
                defaultItem.appendTo("#chapterId");
                $.each(response.data, function (index, item) {
                    var opt = $('<option value="' + item.id + '">' + item.name + '</option>');
                    opt.appendTo("#chapterId");
                });
                if (defVal != null && defVal != '') {
                    $("#chapterId").val(defVal);
                }
            });
        }

        $(function () {
            $("body").on("change", ".answer_", function () {
                var isTrue = $(this).find("option:selected").text();
                var label = $(this).find("option:selected").parent().parent().parent().find("td").eq(2).find("input").val();

                if (isTrue == "是") {
                    $("#_answer_").val(label);
                } else {
                    var answer = $("#_answer_").val();
                    if (answer.indexOf(label) != -1) {//此选项已经选择，需要清空
                        $("#_answer_").val("");
                    }
                }
            })
        });

    </script>

</head>
<body id="" class=""  style="">
	
<form id="inputForm" class="form-horizontal" action="http://www.jiudingdalv.com/exam/a/questioninfo/questionInfo/save" method="post">
    <input id="id" name="id" type="hidden" value="005b0da8eaf744bcb53436fdb271556e"/>
    
<!-- 0:隐藏tip, 1隐藏box,不设置显示全部 -->


<script type="text/javascript">top.$.jBox.closeTip();</script>

    <table class="table table-bordered  table-condensed dataTables-example dataTable no-footer">
        <tbody>
        <tr>
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>所属模块：</label></td>
            <td class="width-35">
                <select id="module" name="module" class="form-control ">
                    <option value="">请选择模块</option>
                    <option value="10" selected="selected">免费模考</option><option value="20">模拟考试</option><option value="30">题库选择</option><option value="40">综合题库</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>试题归类：</label></td>
            <td class="width-35">
                <select id="proId" name="proId" class="form-control ">
                    <option value="">请选择专业</option>
                    <option value="b74e282250f942da864ef02ae0cac37c" selected="selected">电气工程</option><option value="fe65b9a538dd47069078427b8d2014a2">企业文化、电力与能源战略</option><option value="04140294bbce4314b94a1db438bdd415">电气工程（免费部分）</option><option value="69670fdc9e8d4c71bc959fd9e493580d">测试专业</option>
                </select>
                <select id="subId" name="subId" class="form-control ">
                    <option value="">请选择学科</option>
                </select>
                <select id="chapterId" name="chapterId" class="form-control ">
                    <option value="" selected="selected">请选择章节</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>题型：</label></td>
            <td class="width-35">
                <select id="quesType" name="type" class="form-control ">
                    <option value="">请选择</option>
                    <option value="type_danxuan" selected="selected">单选题</option><option value="type_duoxuan">多选题</option><option value="type_panduan">判断题</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>题目：</label></td>
            <td class="width-35">
                <input id="questiontitle" name="questiontitle" class="form-control required" type="text" value="测试" maxlength="500"/>
            </td>
        </tr>
        <tr class="answer answer_select">
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>答案：</label></td>
            <td class="width-35">
                <input id="_answer_" name="answer" class="form-control required" type="text" value="a" maxlength="10"/>
            </td>
        </tr>
        <tr class="answer answer_judgment hide">
            <td class="width-15 active"><label class="pull-right"><font color="red">*</font>答案：</label></td>
            <td class="width-35">
                <select id="answer" name="answer" class="form-control ">
                    <option value="">请选择</option>
                    <option value="1">简单</option><option value="20">困难</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right">级别：</label></td>
            <td class="width-35">
                <select id="level" name="level" class="form-control ">
                    <option value="">请选择</option>
                    <option value="1" selected="selected">简单</option><option value="20">困难</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right">答案解析：</label></td>
            <td class="width-35">
                <textarea id="analysis" name="analysis" maxlength="255" class="form-control " rows="4">a</textarea>
            </td>
        </tr>
        <tr>
            <td class="width-15 active"><label class="pull-right">备注信息：</label></td>
            <td class="width-35">
                <textarea id="remarks" name="remarks" maxlength="255" class="form-control " rows="4">a</textarea>
            </td>
        </tr>

        </tbody>
    </table>
    
    <div class="quesOptionList hide">
        <!-- 新增按钮 -->
        <a class="btn btn-white btn-sm"
           onclick="addRow('#optionList', rowIdx, optionListTpl);rowIdx = rowIdx + 1;"><i
                class="fa fa-plus"></i> 新增选项</a>
        <!-- 展示表格 -->
        <table class="table table-bordered table-condensed">
            <thead>
            <tr>
                <th width="50">序号</th>
                <th width="60">选项名</th>
                <th width="150">选项内容</th>
                <th width="130" id="ifAnswer">是否正确答案</th>
                <th width="50">操作</th>
            </tr>
            </thead>
            <tbody id="optionList">
            </tbody>
        </table>
        <!-- 车辆信息模板 -->
        <script type="text/template" id="optionListTpl">
            <tr id="optionList{{idx}}">
                <td class="hide">
                    <input id="optionList{{idx}}_id"
                           name="optionList[{{idx}}].id" type="hidden"
                           value="{{row.id}}"/>
                    <input id="optionList{{idx}}_quesId"
                           name="optionList[{{idx}}].quesId" type="hidden"
                           value="{{row.quesId}}"/>
                    <input id="optionList{{idx}}_delFlag"
                           name="optionList[{{idx}}].delFlag" type="hidden"
                           value="0"/>
                </td>
                    
                <td>
                    <span class="option_index">{{idx_}}</span>
                </td>
                    
                <td>
                    <input id="optionList{{idx}}_label"
                           name="optionList[{{idx}}].optionLabel" type="text"
                           value="{{row.optionLabel}}" class="form-control required"/>
                </td>
                    
                <td>
                    <input id="optionList{{idx}}_content"
                           name="optionList[{{idx}}].content" type="text"
                           value="{{row.content}}" class="form-control required" style="width: 150px;"/>
                </td>
                    
                <td>
                    <select id="optionList{{idx}}_isAnswer"
                            name="optionList[{{idx}}].isAnswer"
                            data-value="{{row.isAnswer}}"
                            class="form-control m-b answer_">
                        <option value="">请选择</option>
                        
                            <option value="1">是</option>
                        
                            <option value="0">否</option>
                        
                    </select>
                </td>
                    
                <td class="text-center" width="10">
                    {{#delBtn}}<span class="close"
                                            onclick="delRow(this, '#optionList{{idx}}')"
                                            title="删除">&times;</span>{{/delBtn}}
                </td>
                <td>

                </td>
            </tr>
        </script>
        <!-- 单选题选项列表JS -->
        <script type="text/javascript">
            var rowIdx = 0,
                optionListTpl = $("#optionListTpl").html().replace(/(\/\/\<!\-\-)|(\/\/\-\->)/g, "");
            $(document).ready(function () {
                var data = [{"id":"d68249b78ed14ec49ef50d8a59b1442d","isNewRecord":false,"remarks":null,"createDate":null,"updateDate":null,"quesId":"005b0da8eaf744bcb53436fdb271556e","optionLabel":"a","content":"123","isAnswer":"1","questionInfo":null},{"id":"31b5046be8a04a8a997bb0635cc4c0f8","isNewRecord":false,"remarks":null,"createDate":null,"updateDate":null,"quesId":"005b0da8eaf744bcb53436fdb271556e","optionLabel":"b","content":"123","isAnswer":"0","questionInfo":null},{"id":"daca0c90847441338a2c5ba52cc1ca6c","isNewRecord":false,"remarks":null,"createDate":null,"updateDate":null,"quesId":"005b0da8eaf744bcb53436fdb271556e","optionLabel":"c","content":"123","isAnswer":"0","questionInfo":null}];
                for (var i = 0; i < data.length; i++) {
                    addRow('#optionList', rowIdx, optionListTpl, data[i]);
                    rowIdx = rowIdx + 1;
                }
            });
        </script>
    </div>
</form>

	<script type="text/javascript">//<!-- 无框架时，左上角显示菜单图标按钮。
		if(!(self.frameElement && self.frameElement.tagName=="IFRAME")){
			$("body").prepend("<i id=\"btnMenu\" class=\"icon-th-list\" style=\"cursor:pointer;float:right;margin:10px;\"></i><div id=\"menuContent\"></div>");
			$("#btnMenu").click(function(){

				top.layer.open({
				    type: 2, 
				    area:['300px','350px'],
				    content: 'get:http://www.jiudingdalv.com/exam/a/sys/menu/treeselect;JSESSIONID=d8710c9d7cdc4054938ab46244c8ad50' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
				});
				//top.$.jBox('get:http://www.jiudingdalv.com/exam/a/sys/menu/treeselect;JSESSIONID=d8710c9d7cdc4054938ab46244c8ad50', {title:'选择菜单', buttons:{'关闭':true}, width:300, height: 350, top:10});
				//if ($("#menuContent").html()==""){$.get("http://www.jiudingdalv.com/exam/a/sys/menu/treeselect", function(data){$("#menuContent").html(data);});}else{$("#menuContent").toggle(100);}
			});
		}//-->
	</script>
</body>
</html>